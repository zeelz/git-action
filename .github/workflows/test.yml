on:
    # push:
    pull_request:

jobs:
    test-api:
        runs-on: ubuntu-latest

        steps:
            # - name: checkout
            #   uses: "actions/checkout@v4"

            # - name: node setup
            #   uses: "actions/setup-node@v3"

            # - name: install packages
            #   run: npm i

            # - name: test
            #   run: npm run test

            - name: if test fails
              run: |

                switch_case() {
                    local value="$1"

                    case "$value" in
                        "zeelz")
                            echo "U0104R4ULSW"
                            ;;
                        "car")
                            echo "Vehicle"
                            ;;
                        "blue")
                            echo "Color"
                            ;;
                        *)
                            echo "Unknown"
                            return 1
                            ;;
                    esac
                }

                MEMBER_ID=$(switch_case "zeelz" )
                PR_TITLE="${{ github.event.pull_request.title }}" # github.event.head_commit.message
                JOB_URL="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}/job/${{ job.id }}",

                NOTIF_TEXT="Some test checks for the pull request _*$PR_TITLE*_ were not successful\nSee $JOB_URL\nActor involved <@$MEMBER_ID>"
                
                curl -X POST -H "Content-Type: application/json" -d "{\"text\": \"$NOTIF_TEXT\"}" ${{ secrets.SLACK_APP_WEBHOOK_URL }}